<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>数据列表</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* 保持原有样式 */
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <!-- 保持原有导航栏结构 -->
    </nav>

    <div class="container mt-4">
        <div class="d-flex justify-content-between mb-3">
            <h4><i class="fas fa-list"></i> 数据列表</h4>
            <div>
                <a href="/mmdemo/data/add" class="btn btn-primary">
                    <i class="fas fa-plus"></i> 添加数据
                </a>
            </div>
        </div>

        <div class="alert alert-danger" id="errorMessage" role="alert" style="display: none;"></div>
        <div class="alert alert-success" id="successMessage" role="alert" style="display: none;"></div>

        <div class="empty-list" id="emptyList" style="display: none;">
            <i class="fas fa-database fa-3x mb-3"></i>
            <p>暂无数据记录</p>
            <a href="/mmdemo/data/add" class="btn btn-primary">添加数据</a>
        </div>

        <div class="card" id="dataTable" style="display: none;">
            <div class="card-body">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>名称</th>
                            <th>描述</th>
                            <th>类别</th>
                            <th>创建时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="dataList"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 在script标签中添加
        const API_BASE_URL = '/mmdemo/api';

        // 修改所有API调用
        async function loadData() {
            try {
                const response = await axios.get(`${API_BASE_URL}/data`);
                const dataList = response.data.data || [];

                if (dataList.length === 0) {
                    document.getElementById('emptyList').style.display = 'block';
                    document.getElementById('dataTable').style.display = 'none';
                } else {
                    document.getElementById('emptyList').style.display = 'none';
                    document.getElementById('dataTable').style.display = 'block';

                    const tbody = document.getElementById('dataList');
                    tbody.innerHTML = '';

                    dataList.forEach(data => {
                        // 使用可选链操作符和空值合并操作符来处理可能的undefined值
                        const row = `
                    <tr>
                        <td>${data?.id || ''}</td>
                        <td>${data?.name || ''}</td>
                        <td>${data?.description || ''}</td>
                        <td>${data?.category || ''}</td>
                        <td>${formatDate(data?.createdDate)}</td>
                        <td class="action-buttons">
                            <a href="/mmdemo/data/view/${data?.id}" class="btn btn-sm btn-info me-1">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="/mmdemo/data/edit/${data?.id}" class="btn btn-sm btn-warning me-1">
                                <i class="fas fa-edit"></i>
                            </a>
                            <button onclick="deleteData(${data?.id})" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                        tbody.innerHTML += row;
                    });
                }
            } catch (error) {
                console.error('加载数据错误:', error);
                if (error.response?.status === 401) {
                    window.location.href = '/mmdemo/login';
                } else {
                    showError('加载数据失败：' + (error.response?.data?.message || error.message));
                }
            }
        }

        async function deleteData(id) {
            if (!confirm('确定要删除这条数据吗？')) {
                return;
            }

            try {
                const response = await axios.delete(`${API_BASE_URL}/data/${id}`);
                if (response.data.success) {
                    showSuccess('删除成功');
                    loadData();
                }
            } catch (error) {
                showError(error.response?.data?.message || '删除失败');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 3000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMessage');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 3000);
        }

        // 页面加载时获取数据
        loadData();
    </script>
</body>
</html>
<script>
    // 在页面顶部添加导航栏
    document.querySelector('.navbar').innerHTML = `
    <div class="container">
        <a class="navbar-brand" href="/mmdemo/dashboard">
            <i class="fas fa-tachometer-alt"></i> 系统控制台
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/mmdemo/dashboard">
                        <i class="fas fa-home"></i> 首页
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/mmdemo/data">
                        <i class="fas fa-database"></i> 数据管理
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" href="#" onclick="handleLogout(event)">
                        <i class="fas fa-sign-out-alt"></i> 退出
                    </a>
                </li>
            </ul>
        </div>
    </div>
`;

    // 修改添加数据按钮的链接
    document.querySelector('a[href="/data/add"]').href = '/mmdemo/data/add';
</script>
<script>
    // 添加在script标签中
    function formatDate(dateString) {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        } catch (e) {
            console.error('日期格式化错误:', e);
            return dateString;
        }
    }
</script>
