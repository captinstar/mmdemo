<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* 保持原有样式 */
    </style>
</head>
<body>
    <div class="container">
        <div class="login-container">
            <h2 class="login-title">系统登录</h2>
            <div class="error-message" id="errorMessage" style="display: none;"></div>

            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="mb-3">
                    <label for="username" class="form-label">用户名</label>
                    <input class="form-control" id="username" required type="text">
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">密码</label>
                    <input class="form-control" id="password" required type="password">
                </div>
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-login">
                        <i class="fas fa-sign-in-alt"></i> 登录
                    </button>
                    <a class="btn btn-outline-primary" href="/register">
                        <i class="fas fa-user-plus"></i> 注册新用户
                    </a>
                </div>
            </form>
            <div class="alert alert-success mt-3" id="registerSuccess" role="alert" style="display: none;">
                注册成功！请使用新账号登录。
            </div>
        </div>
    </div>

    <script>
        async function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                // 在login.html中修改axios请求路径
                const response = await axios.post('/mmdemo/api/login', {
                    username: username,
                    password: password
                });

                // 在login.html中的handleLogin函数中修改重定向路径
                if (response.data.success) {
                    window.location.href = '/mmdemo/dashboard';  // 添加上下文路径
                }
            } catch (error) {
                const errorMessage = error.response?.data?.message || '登录失败，请重试';
                document.getElementById('errorMessage').textContent = errorMessage;
                document.getElementById('errorMessage').style.display = 'block';
            }
        }

        // 检查URL参数显示注册成功消息
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('registered')) {
            document.getElementById('registerSuccess').style.display = 'block';
        }
    </script>
</body>
</html>